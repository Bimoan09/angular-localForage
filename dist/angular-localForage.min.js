/**
 * copyright: Olivier Combe (https://github.com/ocombe/angular-localForage)
 */
(function(e,t,n,r){"use strict";var i=t.module("LocalForageModule",["ng"]);i.provider("$localForage",function(){n.config({name:"lf"});this.notify={setItem:false,removeItem:false};var e=function(e){return n.setDriver(e)};this.setDriver=e;var r=function(){return n.driver()};this.setNotify=function(e,t){this.notify={setItem:e,removeItem:t}};this.config=function(r){if(t.isObject(r)){if(t.isDefined(r.driver)){n.config(r);return e(r.driver)}else{return n.config(r)}}};this.$get=["$rootScope","$q","$parse",function(i,s,o){var u=this.notify;var a={};var f=function(){return r()==="localStorageWrapper"?n.config().name+".":""};var l=function(t,n,i,s){if(t==="InvalidStateError"&&r()==="asyncStorage"){e("localStorageWrapper").then(function(){i(n).then(function(e){s.resolve(e)},function(e){s.reject(e)})},function(){s.reject(t)})}else{s.reject(t)}};var c=function(e,t){var r=s.defer(),o=arguments;n.setItem(f()+e,t).then(function(){if(u.setItem){i.$broadcast("LocalForageModule.setItem",{key:e,newvalue:t,driver:n.driver()})}r.resolve(t)},function(t){l(t,o,c,r)});return r.promise};var h=function(e){var t=s.defer(),r=arguments;n.getItem(f()+e).then(function(n){t.resolve(n)},function(n){l(n,r,h,t)});return t.promise};var p=function(e){var t=n.removeItem(f()+e);if(u.setItem){return t.then(function(t){i.$broadcast("LocalForageModule.removeItem",{key:e,driver:n.driver()})})}else{return t}};var d=function(){var e=s.defer(),n=arguments,r=[];g().then(function(i){t.forEach(i,function(e){r.push(p(e))});s.all(r).then(function(){e.resolve()})},function(r){l(r,n,clearAll,e)});return e.promise};var v=function(e){var t=s.defer(),r=arguments;n.key(e).then(function(n){t.resolve(n)},function(n){l(n,r,v,t)});return t.promise};var m=function(){var e=s.defer(),t=arguments;n.length().then(function(n){e.resolve(n)},function(r){l(r,t,m,e)});return e.promise};var g=function(){var e=s.defer(),t=arguments;m().then(function(n){var r=[],i=[],o=f();for(var u=0;u<n;u++){r.push(v(u).then(function(e){if(e.indexOf(o)===0){i.push(e.substr(o.length,e.length))}}))}s.all(r).then(function(){e.resolve(i)})},function(r){l(r,t,g,e)});return e.promise};var y=function(e,n){if(t.isString(n)){n={key:n}}else if(!t.isObject(n)||t.isUndefined(n.key)){throw"You must defined a key to bind"}var r={defaultValue:"",storeName:""};n=t.extend(r,n||{});var i=n.storeName||n.key,s=o(n.key);return h(i).then(function(r){if(r){s.assign(e,r)}else if(n.defaultValue){c(i,n.defaultValue)}if(t.isDefined(a[n.key])){a[n.key]()}a[n.key]=e.$watch(o(n.key),function(e){if(t.isDefined(e)){c(i,e)}},true)})};var b=function(e,n,r){r=r||n;o(n).assign(e,null);if(t.isDefined(a[n])){a[n]();delete a[n]}p(r)};return{setDriver:e,driver:r,getDriver:r,setItem:c,set:c,getItem:h,get:h,remove:p,removeItem:p,clear:d,clearAll:d,key:v,getKeyAt:v,getKeys:g,length:m,getLength:m,bind:y,unbind:b}}]});i.directive("localForage",["$localForage",function(e){return{restrict:"A",link:function(n,r,i){var s=n.$eval(i.localForage);if(t.isObject(s)&&t.isDefined(s.key)&&t.isDefined(s.storeName)){e.bind(n,s)}else{e.bind(n,i.localForage)}}}}])})(window,window.angular,window.localforage)